<Window x:Class="PackageManager.ConfigPresetWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:controls="clr-namespace:CustomControlLibrary.CustomControl.Controls;assembly=CustomControlLibrary"
        xmlns:button="clr-namespace:CustomControlLibrary.CustomControl.Controls.Button;assembly=CustomControlLibrary"
        xmlns:models="clr-namespace:PackageManager.Models"
        xmlns:local="clr-namespace:PackageManager"
        xmlns:conv="clr-namespace:PackageManager.Converters"
        xmlns:navigation="clr-namespace:CustomControlLibrary.CustomControl.Controls.Navigation;assembly=CustomControlLibrary"
        Title="切换配置" Height="660" Width="1000"
        ResizeMode="CanResize" WindowStartupLocation="CenterOwner" Loaded="Window_Loaded">
    <Window.Resources>
        <local:UrlWrapConverter x:Key="UrlWrapConverter" />
        <conv:PresetToIniConverter x:Key="PresetToIniConverter" />
    </Window.Resources>
    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- 标题 -->
        <TextBlock Grid.Row="0" Text="请选择要应用的预设配置" FontSize="18" FontWeight="Bold" />

        <!-- 可滚动的统一卡片列表（内置 + 自定义 + 添加占位，保持添加在最前） -->
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled" Margin="0,12,0,12">
            <ItemsControl ItemsSource="{Binding PresetItems}">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <WrapPanel />
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.Resources>
                <!-- 配置卡片模板：统一宽度与最高项一致的高度，直接显示INI文本 -->
                <DataTemplate DataType="{x:Type models:ConfigPreset}">
                    <Border x:Name="CardBorder" BorderBrush="#DDD" BorderThickness="1" Padding="10" Margin="0,0,10,10" Width="280" ContextMenuOpening="PresetCard_ContextMenuOpening" Background="Transparent"
                            Height="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=CardHeight}">
                        <StackPanel>
                            <controls:CRadioButton GroupName="PresetGroup" Content="{Binding Name}" Tag="{Binding}" IsChecked="{Binding IsSelected, Mode=TwoWay}" Checked="PresetRadio_Checked" Margin="0,0,0,8"/>
                            <TextBlock FontFamily="Consolas" FontSize="14" TextWrapping="Wrap" Text="{Binding Converter={StaticResource PresetToIniConverter}}"/>
                        </StackPanel>
                        <Border.ContextMenu>
                            <navigation:CContextMenu>
                                <navigation:CMenuItem Header="删除此自定义配置" Click="DeletePresetMenuItem_Click"/>
                            </navigation:CContextMenu>
                        </Border.ContextMenu>
                    </Border>
                </DataTemplate>
                <!-- 添加卡片模板：始终置于最前 -->
                <DataTemplate DataType="{x:Type local:AddCardPlaceholder}">
                    <Border BorderBrush="#DDD" BorderThickness="1" Padding="10" Margin="0,0,10,10" Width="280" Background="#F9F9F9" MouseLeftButtonUp="AddPresetCard_MouseLeftButtonUp" Cursor="Hand"
                            Height="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=CardHeight}">
                        <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                            <TextBlock Text="+" FontSize="32" FontWeight="Bold" HorizontalAlignment="Center"/>
                            <TextBlock Text="添加自定义配置" Margin="0,8,0,0" FontSize="14" HorizontalAlignment="Center"/>
                        </StackPanel>
                    </Border>
                </DataTemplate>
                </ItemsControl.Resources>
            </ItemsControl>
        </ScrollViewer>

        <!-- 底部操作 -->
        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right">
            <button:CButton Content="应用" Width="100" Margin="0,0,10,0" Click="ApplyButton_Click"/>
            <button:CButton Content="取消" Width="100" Click="CancelButton_Click"/>
        </StackPanel>
    </Grid>
</Window>
