# PackageManager

一个用于管理产品包版本与更新的 Windows 桌面应用，聚合“包更新、配置预设、自动更新、日志/工具”等能力，帮助团队在本地环境下高效完成版本切换、校验与分发。

## 核心功能

- 包更新与校验
  - 支持从 FTP 获取版本目录并进行排序（兼容带日期前缀的命名，如 `2025.09.30_v1.5.2`）。
  - 统一的阶段/进度展示：下载、解压、签名/加密校验等。
  - 文件锁定检测与“解锁更新”流程（Windows Restart Manager）。
  - 运行外部校验工具（签名/加密），支持取消与实时日志输出。
- 配置预设管理
  - 支持内置与自定义预设；自定义预设以完整 INI 文本存储（`RawIniContent`）。
  - 当当前配置不在预设列表时，自动创建“当前配置”卡片并选中。
  - 预设选择窗口（`ConfigPresetWindow`）与新增窗口（`AddPresetWindow`）。
- 自动更新
  - `AppUpdateService` 支持从 FTP 检查/下载新版本，进行版本比对并后台替换。
  - 更新服务器地址可在设置中配置（`UpdateServerUrl`），支持从 JSON 设置加载。
- 本地路径设置
  - 支持为不同产品配置本地包路径，并按版本维度进行配置与获取。
  - 提供 `LocalPathSettingsWindow` 进行集中管理与可视化展示。
- 日志与工具
  - 日志查看器：按类型/日期/级别筛选、搜索与自动滚动；支持多种打开方式（LogViewPro、VSCode、记事本）。
  - 常用网址导航（含 210/215 等站点）；产品日志独立窗口。
  - DNS 设置与编辑（添加/编辑/删除 IPv4 DNS，支持跳转到系统网络设置）。
  - CSV 加/解密工具，支持拖拽与批量处理。
- 界面与交互
  - 主界面筛选按钮与弹出式条件编辑器，筛选条件持久化保存与恢复。
  - 自定义导航控件、分栏布局与可调节分割器；统一控件样式与应用图标。
  - Toast 提示服务与管理员权限自动提升。

## 运行与快速上手

- 直接运行 `PackageManager.exe`（位于 `bin/Release/` 或 `bin/Debug/`），无需额外依赖（集成 Costura.Fody 以嵌入依赖）。
- 首次启动建议：
  - 在“设置”中配置更新服务器地址（`UpdateServerUrl`）与相关路径选项。
  - 在“本地路径设置”中按产品与版本配置本地包路径。
  - 如需切换配置，打开“配置预设”窗口选择/新增预设；粘贴完整 INI 文本即可。

## 使用指南

- 包更新
  - 在主表格中选择目标包与版本，点击更新；可在过程日志中观察阶段与进度。
  - 若遇到文件被占用，使用“解锁更新”按钮进行处理（自动尝试关闭占用进程并继续）。
- 校验与取消
  - 触发签名/加密校验流程后，可使用“取消”按钮终止外部工具执行。
  - 取消后进程会被安全终止，阶段状态与日志会被妥善记录。
- 筛选与视图
  - 点击筛选按钮打开条件编辑器；确认后条件会被保存，重启应用仍可恢复。
  - 支持对各列进行精确筛选与组合筛选，便于在大量包/版本中快速定位。
- 日志与工具
  - 在“产品日志”窗口中查看并打开日志文件；也可从主界面打开日志查看器进行筛选与搜索。
  - 使用“DNS 设置”与“CSV 加解密”工具完成常用网络与文件处理任务。

## 配置与数据

- 设置与状态
  - 应用设置与主窗口状态通过数据持久化服务统一管理（JSON）。
  - 更新服务器地址、程序入口文件是否带 `G`（`ProgramEntryWithG`）等选项可在设置中配置。
- 预设与包配置
  - 配置预设通过 `ConfigPresetStore` 读写（如 `UserPresets.json`）。
  - 包配置管理支持内置与自定义配置的增删改查，并与主界面集成。
- 路径与版本
  - 本地路径支持按版本维度维护；版本选择逻辑对不同产品有所优化（如 Dazzle 强制选择首个可用版本）。

## 常见问题

- 文件被占用导致更新失败
  - 使用“解锁更新”功能；应用会尝试关闭占用进程并对被占用文件进行暂存与后续替换。
- 更新提示但版本未变
  - 检查 FTP 目录命名是否符合约定；已支持提取 `vX.Y[.Z[.W]]` 并忽略日期前缀。
- 预设匹配不上当前配置
  - 应用会自动创建“当前配置”卡片并选中；可在预设窗口中编辑或保存为自定义预设。

## 版本管理

- 详细版本更新记录请参阅仓库根目录的 `CHANGELOG.md`。
- 变更依据来自 `gitlog.md` 提交历史，按版本号进行归档与提炼。

## 贡献与反馈

- 欢迎通过 Issue 或提交 PR 的方式反馈问题与建议。
- 如需新增内置功能或优化流程，可附上使用场景与期望的交互方式以便评估。

## 许可

- 许可协议未在仓库中声明时，默认仅供内部团队使用；如需开源发布请先补充 LICENSE。

